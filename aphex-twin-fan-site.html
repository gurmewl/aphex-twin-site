<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aphex Twin Fan Site</title>
  <!-- Подключение Orbitron через Google Fonts для современного вида -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <!-- Подключение Three.js для 3D и визуализации -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
  <style>
    /* ========== ОСНОВНЫЕ СБРОСЫ ========== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Orbitron', Arial, sans-serif;
      color: #ddd;
      background: linear-gradient(135deg, #111 0%, #23233a 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    a { color: inherit; }

    /* ========== НАВИГАЦИЯ ========== */
    #navbar {
      position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
      background: rgba(10,10,20,0.5); backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(20,0,60,0.08);
      transition: top 0.3s ease;
    }
    #navbar .nav-container {
      max-width: 1200px; margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 20px;
    }
    #navbar .logo {
      font-size: 2rem; font-weight: 700; letter-spacing: 2px;
      color: #fff; text-decoration: none; transition: color 0.2s;
    }
    #navbar .logo:hover { color: #4A90E2; }
    #navbar .nav-links {
      list-style: none; display: flex; gap: 24px;
    }
    #navbar .nav-links li a {
      color: #ddd; text-decoration: none; font-size: 1.1rem; font-weight: 500;
      padding: 4px 0; border-bottom: 2px solid transparent;
      transition: color 0.2s, border-bottom-color 0.3s;
    }
    #navbar .nav-links li a:hover, #navbar .nav-links li a:focus {
      color: #4A90E2; border-bottom-color: #4A90E2;
    }
    #navbar.hide { top: -80px; }
    /* Бургер-меню (адаптив) */
    .burger { display: none; flex-direction: column; gap: 5px; cursor: pointer; }
    .burger span {
      display: block; width: 25px; height: 3px; background: #fff; border-radius: 2px;
      transition: 0.3s;
    }
    @media (max-width: 900px) {
      #navbar .nav-links { display: none; position: absolute; right: 20px; top: 60px; background: rgba(20,22,33,0.97); flex-direction: column; gap: 0; border-radius: 10px; min-width: 180px; }
      #navbar .nav-links.active { display: flex; }
      #navbar .nav-links li { border-bottom: 1px solid #222; }
      #navbar .nav-links li:last-child { border-bottom: none; }
      #navbar .nav-links li a { padding: 16px 20px; }
      .burger { display: flex; }
    }

    /* ========== ОБЩИЕ БЛОКИ ========== */
    .section-container {
      padding: 60px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h2 {
      text-align: center; margin-bottom: 40px; font-size: 2rem; font-weight: 700; letter-spacing: 1.5px; position: relative;
      color: #fff;
    }
    h2::after {
      content: '';
      width: 80px; height: 4px;
      background: linear-gradient(90deg, #4A90E2, #9013FE);
      display: block;
      margin: 12px auto 0;
      border-radius: 2px;
    }

    /* ========== INTRO ========== */
    #intro {
      position: relative; width: 100%; height: 100vh; min-height: 600px; overflow: hidden;
      display: flex; align-items: center; justify-content: center; flex-direction: column;
    }
    #bg-canvas {
      position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; display: block; z-index: 1;
      pointer-events: none;
    }
    .intro-content {
      position: relative; z-index: 2; color: #fff; text-align: center;
      top: 50%; transform: translateY(-50%);
      width: 100%;
    }
    .intro-content h1 {
      font-size: 3rem; text-shadow: 0 0 14px rgba(0,0,0,0.7); font-weight: 700;
    }
    .intro-content p { margin: 24px 0; font-size: 1.3rem; color: #b8b8f7; }
    .intro-content .btn {
      display: inline-block; padding: 14px 30px;
      background: linear-gradient(135deg, #4A90E2, #9013FE);
      color: #fff; text-decoration: none; border-radius: 25px;
      font-size: 1.1rem; font-weight: 600;
      letter-spacing: 1px;
      box-shadow: 0 8px 24px rgba(40,0,90,0.16);
      transition: transform 0.3s, box-shadow 0.3s, background 0.2s;
    }
    .intro-content .btn:hover {
      transform: scale(1.06); box-shadow: 0 12px 32px rgba(60,0,120,0.25);
      background: linear-gradient(135deg, #9013FE, #4A90E2);
    }

    /* ========== БИОГРАФИЯ ========== */
    .bio-content {
      display: flex; flex-wrap: wrap; gap: 32px;
      align-items: center; justify-content: center;
    }
    .bio-image {
      max-width: 320px; border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      flex: 0 0 320px;
    }
    .bio-text {
      max-width: 700px; line-height: 1.7; text-align: justify; font-size: 1.08rem;
      color: #e3e3fb;
      background: rgba(25,25,44,0.35); padding: 18px 22px; border-radius: 12px;
    }

    /* ========== ДИСКОГРАФИЯ ========== */
    .album-grid {
      display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center;
    }
    .album-card {
      width: 260px; border-radius: 14px; overflow: hidden;
      background: rgba(20, 20, 30, 0.7); backdrop-filter: blur(7px);
      transform-style: preserve-3d; transition: transform 0.4s, box-shadow 0.4s;
      box-shadow: 0 20px 44px rgba(0,0,0,0.34);
      border: 1.5px solid #28285144;
      cursor: pointer;
    }
    .album-card img { width: 100%; display: block; }
    .album-info { padding: 17px 16px 20px 16px; }
    .album-info h3 { font-size: 1.15rem; margin-bottom: 8px; color: #aee6ff; }
    .album-info p { font-size: 0.97rem; margin-bottom: 12px; color: #c6c6e0; }
    .album-info .play-btn {
      padding: 8px 16px; background: linear-gradient(135deg, #9013FE, #4A90E2);
      color: #fff; border: none; border-radius: 22px; cursor: pointer;
      font-size: 0.97rem; font-weight: 600;
      box-shadow: 0 2px 12px rgba(90,0,140,0.13);
      transition: transform 0.3s, box-shadow 0.3s, background 0.2s;
    }
    .album-info .play-btn:hover {
      transform: scale(1.08); box-shadow: 0 6px 20px rgba(0,0,0,0.26);
      background: linear-gradient(135deg, #4A90E2, #9013FE);
    }
    .album-card:hover, .album-card:focus-within {
      transform: rotateY(8deg) scale(1.035); box-shadow: 0 32px 75px rgba(0,0,0,0.50);
    }
    #track-player { margin: 24px auto 0 auto; display: block; }

    /* ========== 3D КУБ ========== */
    #viewer-rotator { perspective: 800px; width: 310px; height: 310px; margin: 0 auto 20px; cursor: grab; }
    #cube { width: 200px; height: 200px; position: relative; margin: auto; top: 50%; transform-style: preserve-3d; transition: transform 0.1s; }
    #cube .face { position: absolute; width: 200px; height: 200px; backface-visibility: hidden; overflow: hidden; border-radius: 8px; box-shadow: 0 8px 22px rgba(0,0,0,0.31);}
    #cube .face img { width: 100%; height: 100%; object-fit: cover; }
    #cube .front  { transform: translateZ(100px); }
    #cube .back   { transform: rotateY(180deg) translateZ(100px); }
    #cube .right  { transform: rotateY(90deg) translateZ(100px); }
    #cube .left   { transform: rotateY(-90deg) translateZ(100px); }
    #cube .top    { transform: rotateX(90deg) translateZ(100px); }
    #cube .bottom { transform: rotateX(-90deg) translateZ(100px); }
    .rotator-instruction { text-align: center; color: #aaa; font-size: 0.98rem; margin-top: 15px;}

    /* ========== ВИЗУАЛИЗАТОР ========== */
    #visualizer .viz-controls { text-align: center; margin-bottom: 20px; }
    #visualizer .viz-controls select, #visualizer .viz-controls button {
      padding: 10px 14px; font-size: 1rem; margin: 0 8px; border-radius: 7px; border: none;
      background: #23233a; color: #eee; font-family: inherit;
      box-shadow: 0 2px 8px rgba(50,40,100,0.1);
      transition: background 0.2s;
    }
    #visualizer .viz-controls select:focus, #visualizer .viz-controls button:focus { outline: 2px solid #9013FE; }
    #visualizer .viz-controls button { background: linear-gradient(93deg, #4A90E2 40%, #9013FE 100%); color: #fff; font-weight: 600;}
    #visualizer .viz-controls button:hover { background: linear-gradient(93deg, #9013FE 40%, #4A90E2 100%);}
    #viz-container {
      position: relative; width: 100%; height: 400px; background: #1a1a2b; overflow: hidden; border-radius: 16px;
      box-shadow: 0 6px 30px rgba(0,0,0,0.22);
    }
    #visualizer-canvas { width: 100%; height: 100%; display: block; }

    /* ========== ГАЛЕРЕЯ ========== */
    .gallery-grid { display: flex; flex-wrap: wrap; gap: 14px; justify-content: center; }
    .gallery-item { width: 200px; height: 200px; overflow: hidden; border-radius: 9px; box-shadow: 0 10px 34px rgba(0,0,0,0.38); background: #23233a;}
    .gallery-item img {
      width: 100%; height: 100%; object-fit: cover; transition: transform 0.26s cubic-bezier(.55,0,.1,1.3);
    }
    .gallery-item img:hover, .gallery-item img:focus { transform: scale(1.09) rotate(-2deg); }

    /* ========== КОНТАКТЫ ========== */
    #contacts p { text-align: center; font-size: 1.05rem; color: #b5b5d9;}

    /* ========== АДАПТИВНОСТЬ ========== */
    @media (max-width: 1050px) {
      .bio-content { flex-direction: column; }
      .bio-image { margin-bottom: 20px; }
    }
    @media (max-width: 768px) {
      .album-card { width: 90vw; max-width: 340px; }
      #viewer-rotator { width: 240px; height: 240px; }
      #cube, #cube .face { width: 140px; height: 140px; }
      #viz-container { height: 240px; }
      .gallery-item { width: 40vw; height: 40vw; min-width: 120px; min-height: 120px; }
    }
    @media (max-width: 480px) {
      .section-container { padding: 35px 5vw; }
      #intro { min-height: 420px; }
      .gallery-item { width: 90vw; height: 90vw; }
      #viewer-rotator { width: 150px; height: 150px; }
      #cube, #cube .face { width: 90px; height: 90px; }
      #viz-container { height: 110px; }
      .bio-image { max-width: 95vw; }
    }
  </style>
</head>
<body>
  <!-- Навигация -->
  <nav id="navbar">
    <div class="nav-container">
      <a href="#intro" class="logo">Aphex Twin</a>
      <ul class="nav-links">
        <li><a href="#intro">Главная</a></li>
        <li><a href="#biography">Биография</a></li>
        <li><a href="#discography">Дискография</a></li>
        <li><a href="#rotator">3D Кейс</a></li>
        <li><a href="#visualizer">Визуализатор</a></li>
        <li><a href="#gallery">Галерея</a></li>
        <li><a href="#contacts">Контакты</a></li>
      </ul>
      <div class="burger" aria-label="Открыть меню" tabindex="0"><span></span><span></span><span></span></div>
    </div>
  </nav>

  <!-- Intro -->
  <section id="intro">
    <canvas id="bg-canvas"></canvas>
    <div class="intro-content">
      <h1>Aphex Twin</h1>
      <p>Fan Site: атмосферный дизайн, 3D-эффекты и аудиовизуализация</p>
      <a href="#discography" class="btn">Исследовать дискографию</a>
    </div>
  </section>

  <!-- Биография -->
  <section id="biography" class="section-container">
    <h2>Биография</h2>
    <div class="bio-content">
      <img src="assets/images/rdj_portrait.jpg" alt="Richard D. James" class="bio-image">
      <div class="bio-text">
        <p>
          Richard D. James (род. 18 августа 1971) — британский музыкальный продюсер, композитор и исполнитель, широко известный под псевдонимом Aphex Twin. 
          Он считается одним из ключевых фигур в развитии IDM, эмбиента и экспериментальной электронной музыки. 
          Его ранние работы, начиная с конца 1980-х, отличались новаторским подходом к синтезу звука и ритму.
        </p>
        <p>
          Культовые релизы, такие как <em>Selected Ambient Works 85–92</em>, 
          <em>Richard D. James Album</em>, <em>Drukqs</em>, <em>Syro</em> и другие, повлияли на многие поколения музыкантов и слушателей.
          Его треки варьируются от нежного эмбиента до агрессивных ритмов, часто с необычными звуковыми текстурами и сложной перкуссией.
        </p>
        <p>
          Помимо музыки, он известен своими необычными видеоклипами, визуальными экспериментами и редкими живыми выступлениями. 
          Его личность окутана легендами, а сама музыка постоянно остается свежей и вдохновляющей.
        </p>
      </div>
    </div>
  </section>

  <!-- Дискография -->
  <section id="discography" class="section-container">
    <h2>Дискография</h2>
    <div class="album-grid">
      <div class="album-card">
        <img src="assets/images/saw85.jpg" alt="Selected Ambient Works 85–92">
        <div class="album-info">
          <h3>Selected Ambient Works 85–92</h3>
          <p>1992, Ambient / IDM</p>
          <button class="play-btn" data-audio="assets/audio/saw85_excerpt.mp3">▶ Слушать отрывок</button>
        </div>
      </div>
      <div class="album-card">
        <img src="assets/images/rdj_album.jpg" alt="Richard D. James Album">
        <div class="album-info">
          <h3>Richard D. James Album</h3>
          <p>1996, IDM</p>
          <button class="play-btn" data-audio="assets/audio/rdj_album_excerpt.mp3">▶ Слушать отрывок</button>
        </div>
      </div>
      <div class="album-card">
        <img src="assets/images/drukqs.jpg" alt="Drukqs">
        <div class="album-info">
          <h3>Drukqs</h3>
          <p>2001, Experimental / IDM</p>
          <button class="play-btn" data-audio="assets/audio/drukqs_excerpt.mp3">▶ Слушать отрывок</button>
        </div>
      </div>
      <div class="album-card">
        <img src="assets/images/syro.jpg" alt="Syro">
        <div class="album-info">
          <h3>Syro</h3>
          <p>2014, Electro / IDM</p>
          <button class="play-btn" data-audio="assets/audio/syro_excerpt.mp3">▶ Слушать отрывок</button>
        </div>
      </div>
    </div>
    <audio id="track-player" controls style="display: none;"></audio>
  </section>

  <!-- 3D Кейс -->
  <section id="rotator" class="section-container">
    <h2>3D Кейс: Обложки в кубе</h2>
    <div id="viewer-rotator">
      <div id="cube">
        <div class="face front"><img src="assets/images/syro.jpg" alt="Front"></div>
        <div class="face back"><img src="assets/images/drukqs.jpg" alt="Back"></div>
        <div class="face right"><img src="assets/images/saw85.jpg" alt="Right"></div>
        <div class="face left"><img src="assets/images/windowlicker.jpg" alt="Left"></div>
        <div class="face top"><img src="assets/images/rdj_album.jpg" alt="Top"></div>
        <div class="face bottom"><img src="assets/images/other_album.jpg" alt="Bottom"></div>
      </div>
    </div>
    <p class="rotator-instruction">Кликни и тяни, чтобы вращать куб</p>
  </section>

  <!-- Визуализатор -->
  <section id="visualizer" class="section-container">
    <h2>Аудио-Визуализатор</h2>
    <div class="viz-controls">
      <label for="audio-select">Выберите трек:</label>
      <select id="audio-select">
        <option value="assets/audio/windowlicker.mp3">Windowlicker</option>
        <option value="assets/audio/syro_excerpt.mp3">Syro (Excerpt)</option>
      </select>
      <button id="play-viz-btn">▶ Запустить визуализацию</button>
    </div>
    <div id="viz-container">
      <canvas id="visualizer-canvas"></canvas>
    </div>
    <audio id="viz-audio" crossorigin="anonymous"></audio>
  </section>

  <!-- Галерея -->
  <section id="gallery" class="section-container">
    <h2>Галерея</h2>
    <div class="gallery-grid">
      <div class="gallery-item"><img src="assets/images/saw85.jpg" alt=""></div>
      <div class="gallery-item"><img src="assets/images/windowlicker.jpg" alt=""></div>
      <div class="gallery-item"><img src="assets/images/syro.jpg" alt=""></div>
    </div>
  </section>

  <!-- Контакты -->
  <section id="contacts" class="section-container">
    <h2>Контакты</h2>
    <p>Это локальный проект. Если хочешь доработать или внести свои треки, просто помести MP3 в папку <code>assets/audio</code> и добавь в список.</p>
  </section>

  <!-- Скрипты -->
  <script>
    // ======= Адаптивное бургер-меню =======
    (() => {
      const burger = document.querySelector('.burger');
      const navLinks = document.querySelector('.nav-links');
      burger.addEventListener('click', () => {
        navLinks.classList.toggle('active');
      });
      burger.addEventListener('keydown', (e) => {
        if (e.key === "Enter" || e.key === " ") {
          navLinks.classList.toggle('active');
        }
      });
      document.body.addEventListener('click', (e) => {
        if (!burger.contains(e.target) && !navLinks.contains(e.target)) {
          navLinks.classList.remove('active');
        }
      });
    })();

    // ======= Скролл-навигация скрытие =======
    (function() {
      const nav = document.getElementById('navbar');
      let lastScrollTop = 0;
      window.addEventListener('scroll', () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > lastScrollTop && scrollTop > 100) {
          nav.classList.add('hide');
        } else {
          nav.classList.remove('hide');
        }
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
      });
    })();

    // ======= 3D-куб =======
    (function() {
      const viewer = document.getElementById('viewer-rotator');
      const cube = document.getElementById('cube');
      let isDragging = false;
      let startX, startY;
      let currentX = -20, currentY = 20;
      viewer.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        viewer.style.cursor = 'grabbing';
      });
      viewer.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const deltaX = e.clientX - startX;
        const deltaY = e.clientY - startY;
        currentY += deltaX * 0.3;
        currentX -= deltaY * 0.3;
        cube.style.transform = `rotateX(${currentX}deg) rotateY(${currentY}deg)`;
        startX = e.clientX;
        startY = e.clientY;
      });
      document.addEventListener('mouseup', () => {
        isDragging = false;
        viewer.style.cursor = 'grab';
      });
      viewer.addEventListener('touchstart', (e) => {
        isDragging = true;
        const touch = e.touches[0];
        startX = touch.clientX;
        startY = touch.clientY;
      });
      viewer.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        const touch = e.touches[0];
        const deltaX = touch.clientX - startX;
        const deltaY = touch.clientY - startY;
        currentY += deltaX * 0.3;
        currentX -= deltaY * 0.3;
        cube.style.transform = `rotateX(${currentX}deg) rotateY(${currentY}deg)`;
        startX = touch.clientX;
        startY = touch.clientY;
      });
      document.addEventListener('touchend', () => {
        isDragging = false;
      });
      cube.style.transform = `rotateX(${currentX}deg) rotateY(${currentY}deg)`;
    })();

    // ======= Проигрывание отрывков =======
    (function() {
      const trackPlayer = document.getElementById('track-player');
      const buttons = document.querySelectorAll('.play-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const src = btn.getAttribute('data-audio');
          if (!src) return;
          if (trackPlayer.src !== src) {
            trackPlayer.src = src;
          }
          trackPlayer.style.display = 'block';
          trackPlayer.play();
        });
      });
    })();

    // ======= Three.js фон Intro =======
    (function() {
      const canvas = document.getElementById('bg-canvas');
      const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
      let scene, camera, particles, particleGeo, particleMat;
      init();
      animate();
      function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        const count = 500;
        particleGeo = new THREE.BufferGeometry();
        const positions = new Float32Array(count * 3);
        for (let i = 0; i < count; i++) {
          positions[i * 3] = (Math.random() - 0.5) * 20;
          positions[i * 3 + 1] = (Math.random() - 0.5) * 20;
          positions[i * 3 + 2] = (Math.random() - 0.5) * 20;
        }
        particleGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        particleMat = new THREE.PointsMaterial({
          color: 0xffffff,
          size: 0.05,
          transparent: true,
          opacity: 0.7
        });
        particles = new THREE.Points(particleGeo, particleMat);
        scene.add(particles);
        window.addEventListener('resize', onResize);
      }
      function animate() {
        requestAnimationFrame(animate);
        particles.rotation.y += 0.0005;
        renderer.render(scene, camera);
      }
      function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
    })();

    // ======= Визуализатор Three.js + Web Audio =======
    window.addEventListener('DOMContentLoaded', () => {
      const audioSelect = document.getElementById('audio-select');
      const playVizBtn = document.getElementById('play-viz-btn');
      const vizAudio = document.getElementById('viz-audio');
      const canvasViz = document.getElementById('visualizer-canvas');
      const vizContainer = document.getElementById('viz-container');
      let scene, camera, renderer, barsGroup, analyser, dataArray, audioContext, sourceNode, animationId;
      function initThree() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(60, vizContainer.clientWidth / vizContainer.clientHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        renderer = new THREE.WebGLRenderer({ canvas: canvasViz, antialias: true });
        renderer.setSize(vizContainer.clientWidth, vizContainer.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        scene.add(dirLight);
        barsGroup = new THREE.Group();
        scene.add(barsGroup);
        const barCount = 64;
        const radius = 4;
        for (let i = 0; i < barCount; i++) {
          const geometry = new THREE.BoxGeometry(0.3, 1, 0.3);
          const material = new THREE.MeshStandardMaterial({ color: 0x4A90E2 });
          const bar = new THREE.Mesh(geometry, material);
          const angle = (i / barCount) * Math.PI * 2;
          bar.position.set(Math.cos(angle) * radius, 0, Math.sin(angle) * radius);
          bar.rotation.y = -angle;
          barsGroup.add(bar);
        }
        barsGroup.rotation.y = 0;
      }
      function initAudio() {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        sourceNode = audioContext.createMediaElementSource(vizAudio);
        sourceNode.connect(analyser);
        analyser.connect(audioContext.destination);
      }
      function animateVisualizer() {
        animationId = requestAnimationFrame(animateVisualizer);
        analyser.getByteFrequencyData(dataArray);
        barsGroup.children.forEach((bar, index) => {
          const value = dataArray[index];
          const scaleY = Math.max(value / 50, 0.1);
          bar.scale.y = scaleY;
          bar.position.y = scaleY / 2;
          const hue = (value / 255) * 360;
          bar.material.color.setHSL(hue / 360, 0.7, 0.5);
        });
        barsGroup.rotation.y += 0.005;
        renderer.render(scene, camera);
      }
      function onWindowResize() {
        if (!camera || !renderer) return;
        camera.aspect = vizContainer.clientWidth / vizContainer.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(vizContainer.clientWidth, vizContainer.clientHeight);
      }
      window.addEventListener('resize', onWindowResize);
      function startVisualization() {
        if (animationId) cancelAnimationFrame(animationId);
        if (audioContext) audioContext.close();
        initThree();
        initAudio();
        const selectedSrc = audioSelect.value;
        vizAudio.src = selectedSrc;
        vizAudio.load();
        vizAudio.play().then(() => {
          if (audioContext.state === 'suspended') {
            audioContext.resume();
          }
          animateVisualizer();
        }).catch(err => {
          console.warn('Ошибка воспроизведения аудио:', err);
        });
      }
      playVizBtn.addEventListener('click', () => {
        startVisualization();
      });
    });
  </script>
</body>
</html>